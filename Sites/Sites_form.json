{
  "assignment_enabled": false,
  "auto_assign": false,
  "bounding_box": [
    45.4066197,
    -75.6642611,
    46.7732683,
    -71.0666117
  ],
  "created_at": "2018-03-14T14:32:35Z",
  "description": "Sites are spatial clusters of field research activities. Sites are generally larger than plots, and their shape/size is not constrained.",
  "elements": [
    {
      "data_name": "site",
      "default_value": null,
      "description": null,
      "disabled": false,
      "display": "inline",
      "elements": [
        {
          "data_name": "site_id",
          "default_previous_value": false,
          "default_value": null,
          "description": "An identifier for the site. May be a global unique identifier or an identifier specific to the project.\n\nThe site ID should ideally be easily recognizable. It is best to start with letters describing the site, than use numbers as needed. Example: for a site near the Mer Bleue  fertilisation experiment, the Site ID could be something like \"MB-Fert1\".",
          "disabled": false,
          "hidden": false,
          "key": "33f0",
          "label": "Site ID",
          "max_length": 16,
          "min_length": 4,
          "numeric": false,
          "pattern": "([^\\r\\n\\s]+)[a-zA-Z0-9]+(?!\\s\\r|\\n)",
          "pattern_description": "And alpha numeric in single line only",
          "required": true,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "allow_other": true,
          "choice_list_id": "",
          "data_name": "first_defined_by",
          "default_previous_value": false,
          "default_value": null,
          "description": "A list of names of people responsible for defining the original site. The primary collector, especially one who applies a personal identifier (Site ID), should be listed first.",
          "disabled": false,
          "hidden": false,
          "key": "3500",
          "label": "First Defined By",
          "max_length": null,
          "min_length": null,
          "multiple": true,
          "required": true,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "ChoiceField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "date_defined",
          "default_previous_value": false,
          "default_value": "now",
          "description": "The date on which the site was defined.",
          "disabled": false,
          "hidden": false,
          "key": "5fea",
          "label": "Date Defined",
          "required": true,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "DateTimeField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "allow_other": true,
          "choices": [
            {
              "label": "georeferencing/identifying plants",
              "value": "georeferencing/identifying plants"
            },
            {
              "label": "field spectroscopy",
              "value": "field spectroscopy"
            },
            {
              "label": "plot-based vegetation surveys",
              "value": "plot-based vegetation surveys"
            },
            {
              "label": "UAV imagery",
              "value": "UAV imagery"
            }
          ],
          "data_name": "original_purpose",
          "default_previous_value": false,
          "default_value": null,
          "description": "A list of reason(s) why the site was originally defined. The primary purpose should be listed first.",
          "disabled": false,
          "hidden": false,
          "key": "6d80",
          "label": "Original Purpose",
          "max_length": null,
          "min_length": null,
          "multiple": true,
          "required": true,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "ChoiceField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        }
      ],
      "hidden": false,
      "key": "f2fb",
      "label": "Site",
      "required": false,
      "required_conditions": null,
      "required_conditions_type": null,
      "type": "Section",
      "visible_conditions": null,
      "visible_conditions_behavior": "clear",
      "visible_conditions_type": null
    },
    {
      "data_name": "site_geometry",
      "default_value": null,
      "description": null,
      "disabled": false,
      "display": "inline",
      "elements": [
        {
          "data_name": "corners",
          "default_value": null,
          "description": "Points representing site corners (mininum 3).",
          "disabled": false,
          "elements": [
            {
              "data_name": "corner_number",
              "default_previous_value": false,
              "default_value": "1",
              "description": "An identifier for the site corner.",
              "disabled": true,
              "format": "integer",
              "hidden": false,
              "key": "de97",
              "label": "Corner Number",
              "max": null,
              "max_length": null,
              "min": null,
              "min_length": null,
              "numeric": true,
              "required": false,
              "required_conditions": null,
              "required_conditions_type": null,
              "type": "TextField",
              "visible_conditions": null,
              "visible_conditions_behavior": "clear",
              "visible_conditions_type": null
            },
            {
              "data_name": "corner_latitude",
              "default_previous_value": false,
              "default_value": null,
              "description": null,
              "disabled": true,
              "format": "decimal",
              "hidden": true,
              "key": "b1a6",
              "label": "Corner Latitude",
              "max": null,
              "max_length": null,
              "min": null,
              "min_length": null,
              "numeric": true,
              "required": false,
              "required_conditions": null,
              "required_conditions_type": null,
              "type": "TextField",
              "visible_conditions": null,
              "visible_conditions_behavior": "clear",
              "visible_conditions_type": null
            },
            {
              "data_name": "corner_longitude",
              "default_previous_value": false,
              "default_value": null,
              "description": null,
              "disabled": true,
              "format": "decimal",
              "hidden": true,
              "key": "c965",
              "label": "Corner Longitude",
              "max": null,
              "max_length": null,
              "min": null,
              "min_length": null,
              "numeric": true,
              "required": false,
              "required_conditions": null,
              "required_conditions_type": null,
              "type": "TextField",
              "visible_conditions": null,
              "visible_conditions_behavior": "clear",
              "visible_conditions_type": null
            }
          ],
          "geometry_required": true,
          "geometry_types": [
            "Point"
          ],
          "hidden": false,
          "key": "4abf",
          "label": "Corners",
          "max_length": 10,
          "min_length": 3,
          "required": true,
          "required_conditions": null,
          "required_conditions_type": null,
          "title_field_key": null,
          "title_field_keys": [
            "de97"
          ],
          "type": "Repeatable",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "number_of_corners",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": true,
          "format": "decimal",
          "hidden": true,
          "key": "4e54",
          "label": "Number of Corners",
          "max": null,
          "max_length": null,
          "min": null,
          "min_length": null,
          "numeric": true,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "corners_latitude",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": true,
          "hidden": true,
          "key": "f7bb",
          "label": "Corners Latitude",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "corners_longitude",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": true,
          "hidden": true,
          "key": "7a17",
          "label": "Corners Longitude",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "site_latitude",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": true,
          "hidden": true,
          "key": "1d51",
          "label": "Site Latitude",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "site_longitude",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": true,
          "hidden": true,
          "key": "47e5",
          "label": "Site Longitude",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        }
      ],
      "hidden": false,
      "key": "baa0",
      "label": "Site Geometry",
      "required": false,
      "required_conditions": null,
      "required_conditions_type": null,
      "type": "Section",
      "visible_conditions": null,
      "visible_conditions_behavior": "clear",
      "visible_conditions_type": null
    },
    {
      "data_name": "optional_site_info",
      "default_value": null,
      "description": null,
      "disabled": false,
      "display": "inline",
      "elements": [
        {
          "data_name": "verbatim_site",
          "default_previous_value": false,
          "default_value": null,
          "description": "Textual description of the site and/or its location. Example: \"forest stand 300 m north of oak collection in Montreal botanical garden arboretum\".",
          "disabled": false,
          "hidden": false,
          "key": "a2fb",
          "label": "Site Description",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "site_remarks",
          "default_previous_value": false,
          "default_value": null,
          "description": "Comments or notes about the site. Example: \"forest logged in 2002\".",
          "disabled": false,
          "hidden": false,
          "key": "0e2a",
          "label": "Site Remarks",
          "max_length": 200,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "site_audio_remarks",
          "default_value": null,
          "description": "Audio comments about the site.",
          "disabled": false,
          "hidden": false,
          "key": "6abc",
          "label": "Site Audio Remarks",
          "max_length": 5,
          "min_length": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "track_enabled": true,
          "type": "AudioField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "site_photos",
          "default_value": null,
          "description": "Photo(s) of the site.",
          "disabled": false,
          "hidden": false,
          "key": "ee62",
          "label": "Site Photos",
          "max_length": 20,
          "min_length": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "PhotoField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        }
      ],
      "hidden": false,
      "key": "c26e",
      "label": "Optional Site Info",
      "required": false,
      "required_conditions": null,
      "required_conditions_type": null,
      "type": "Section",
      "visible_conditions": null,
      "visible_conditions_behavior": "clear",
      "visible_conditions_type": null
    },
    {
      "data_name": "data_quality_control",
      "default_value": null,
      "description": null,
      "disabled": false,
      "display": "inline",
      "elements": [
        {
          "data_name": "deleted",
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "a05b",
          "label": "Deleted",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "Label",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "deleted_by",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "06ea",
          "label": "Deleted By",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "date_deleted",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "70a8",
          "label": "Date Deleted",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "DateTimeField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "rejection",
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "080e",
          "label": "Rejection",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "Label",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "rejected_by",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": true,
          "hidden": false,
          "key": "c915",
          "label": "Rejected By",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "date_rejected",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": true,
          "hidden": false,
          "key": "7d9a",
          "label": "Date Rejected",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "DateTimeField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "verification",
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "5429",
          "label": "Verification",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "Label",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "verified_by",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "a39d",
          "label": "Verified By",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "date_verified",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "1451",
          "label": "Date Verified",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "DateTimeField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "submission",
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "8355",
          "label": "Submission",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "Label",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "submitted_by",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "2383",
          "label": "Submitted By",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "date_submitted",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "cba9",
          "label": "Date Submitted",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "DateTimeField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "approbation",
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "fccd",
          "label": "Approbation",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "Label",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "approved_by",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "36ee",
          "label": "Approved By",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "date_approved",
          "default_previous_value": false,
          "default_value": "now",
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "9839",
          "label": "Date Approved",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "DateTimeField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "publication",
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "d79f",
          "label": "Publication",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "Label",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "published_by",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "12d6",
          "label": "Published By",
          "max_length": null,
          "min_length": null,
          "numeric": false,
          "pattern": null,
          "pattern_description": null,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        },
        {
          "data_name": "date_published",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "hidden": false,
          "key": "25f0",
          "label": "Date Published",
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "DateTimeField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        }
      ],
      "hidden": false,
      "key": "8fa6",
      "label": "Data Quality Control",
      "required": false,
      "required_conditions": null,
      "required_conditions_type": null,
      "type": "Section",
      "visible_conditions": null,
      "visible_conditions_behavior": "clear",
      "visible_conditions_type": null
    },
    {
      "data_name": "hidden_variables",
      "default_value": null,
      "description": null,
      "disabled": false,
      "display": "inline",
      "elements": [
        {
          "data_name": "number_of_rejections",
          "default_previous_value": false,
          "default_value": null,
          "description": null,
          "disabled": false,
          "format": "decimal",
          "hidden": false,
          "key": "743a",
          "label": "Number of Rejections",
          "max": null,
          "max_length": null,
          "min": 0.0,
          "min_length": null,
          "numeric": true,
          "required": false,
          "required_conditions": null,
          "required_conditions_type": null,
          "type": "TextField",
          "visible_conditions": null,
          "visible_conditions_behavior": "clear",
          "visible_conditions_type": null
        }
      ],
      "hidden": true,
      "key": "64bd",
      "label": "Hidden Variables",
      "required": false,
      "required_conditions": null,
      "required_conditions_type": null,
      "type": "Section",
      "visible_conditions": null,
      "visible_conditions_behavior": "clear",
      "visible_conditions_type": null
    }
  ],
  "geometry_required": true,
  "geometry_types": [
    "Point"
  ],
  "hidden_on_dashboard": false,
  "id": "",
  "image": "https://fulcrumapp.s3.amazonaws.com/form-images/513e9dbf-09be-4eed-88a8-60db607aa1e8-ec07aaa2-ffe4-49fc-bad1-1e3c8cd583ce.png",
  "image_large": "https://fulcrumapp.s3.amazonaws.com/form-images/large_513e9dbf-09be-4eed-88a8-60db607aa1e8-ec07aaa2-ffe4-49fc-bad1-1e3c8cd583ce.png",
  "image_small": "https://fulcrumapp.s3.amazonaws.com/form-images/small_513e9dbf-09be-4eed-88a8-60db607aa1e8-ec07aaa2-ffe4-49fc-bad1-1e3c8cd583ce.png",
  "image_thumbnail": "https://fulcrumapp.s3.amazonaws.com/form-images/thumb_513e9dbf-09be-4eed-88a8-60db607aa1e8-ec07aaa2-ffe4-49fc-bad1-1e3c8cd583ce.png",
  "name": "Sites",
  "projects_enabled": true,
  "record_count": 41,
  "record_title_key": "33f0",
  "script": "/* SAVE VERSIONS */\n\n/*****************************************************************\n\n            FUNCTIONS DATA EVENTS SITES\n\n*******************************************************************/\n\n/*\nAnd alpha numeric in single line only\n([^\\r\\n\\s]+)[a-zA-Z0-9]+(?!\\s\\r|\\n)\n*/\n\n\n/*\n\nCORNERS LONGITUDE IS EMPTY\n\n*/\n\n\n\n/*\n * DEBUG\n */\nfunction viewConfig(){\n  SHOWERRORS(true);\n  ALERT(\">\"+INSPECT(CONFIG()));\n}\n\n/*\n * CONFIGURATION\n */\n\n// Enable or disable manual location\nfunction setConfig4Draft(b){\n  if (b==true||b==false){\n    var config = {\n      drafts_enabled: b\n    };\n    SETFORMATTRIBUTES(config);\n  }\n}\n\nfunction setConfig4Location(b){\n  if (b==true||b==false){\n    var config = {\n      manual_location_enabled: b\n    };\n    SETFORMATTRIBUTES(config);\n  }\n}\n\nfunction setConfig4LocationDraft(b){\n  setConfig4Draft(b);\n  setConfig4Location(b);\n}\n\n/*\n * STATUS and ACCESS TO DATA\n */\nvar projectNameGV    = \"\";\nvar fieldUserRolesGV = ['Standard User','Graduate Student']; // include more roles if needed\nvar usernameGV       = USERFULLNAME();\nvar readOnlyStatusesGV = ['deleted', 'verified', 'submitted', 'approved', 'published'];\n\nfunction isRejected(){\n  return (STATUS()=='rejected' || EXISTS($rejected_by));\n}\n\nfunction isVerified(){\n  return STATUS()=='verified';\n}\n\nfunction isStandardUser(){\n  return ISROLE(fieldUserRolesGV);\n}\n\nfunction isReadOnly(){\n  return CONTAINS(readOnlyStatusesGV, STATUS());\n}\n\nfunction isEditableByUsers(){\n  return ISROLE(fieldUserRolesGV) && !isReadOnly();\n}\n\nfunction isLocked4Users(){\n  return ISROLE(fieldUserRolesGV) && isReadOnly();\n}\n\nfunction getNumOfCorners() {\n  if ($corners != null){\n    return LEN(ARRAY(REPEATABLEVALUES($corners, 'corner_number')));\n  } else {\n    return 0;\n  }\n}\n\nfunction setNumOfCorners() {\n  SETVALUE('number_of_corners',getNumOfCorners());\n}\n\nfunction notSameCornersNumber(){\n  if (VALUE('number_of_corners')==getNumOfCorners()){\n    return false;\n  } else {\n    return true;\n  }\n}\n\nfunction changeValues(){\n  DATANAMES().forEach(function(dataName) {\n    SETREADONLY(dataName, null);\n  });\n  loadDataQualityControl();\n  setConfig4LocationDraft(true);\n  //gpsAccessible(); // NO GPS NEEDED HERE\n}\n\nfunction readOnlyValues(){\n  DATANAMES().forEach(function(dataName) {\n    SETREADONLY(dataName, true);\n  });\n  loadDataQualityControl();\n  setConfig4LocationDraft(false);\n  //gpsNotAccessible(); // NO GPS NEEDED HERE\n}\n\n/*\n * Data Quality Control View\n */\nfunction loadDataQualityControl(){\n  var readOnlyDataQuality = ['data_quality_control','deleted','deleted_by','date_deleted','verification','verified_by','date_verified','submission','submitted_by','date_submitted','approbation','approved_by','date_approved','rejection','rejected_by','date_rejected','publication','published_by','date_published'];\n  \n  readOnlyDataQuality.forEach(function(element) {\n    SETREADONLY(element, true);\n    SETHIDDEN(element,true);\n  });\n  \n  var status = STATUS();\n  if (status=='deleted'){\n    SETHIDDEN('data_quality_control',false);\n    SETHIDDEN('deleted',false);\n    SETHIDDEN('deleted_by',false);\n    SETHIDDEN('date_deleted',false);\n  } else {\n    if (status!='pending'){\n      SETHIDDEN('data_quality_control',false);\n      SETHIDDEN('verification',false);\n      SETHIDDEN('verified_by',false);\n      SETHIDDEN('date_verified',false);\n      if (isRejected()) {\n        SETHIDDEN('rejection',false);\n        SETHIDDEN('rejected_by',false);\n        SETHIDDEN('date_rejected',false);\n      }\n      if (status!='verified'){\n        SETHIDDEN('submission',false);\n        SETHIDDEN('submitted_by',false);\n        SETHIDDEN('date_submitted',false);\n      }\n      if (status=='published' || status=='approved'){\n        SETHIDDEN('approbation',false);\n        SETHIDDEN('approved_by',false);\n        SETHIDDEN('date_approved',false);\n      }\n      if (status=='published'){\n        SETHIDDEN('publication',false);\n        SETHIDDEN('published_by',false);\n        SETHIDDEN('date_published',false);\n      }\n    }\n  }\n}\n\n/*\n * DRAFT TEST\n */\nfunction isDraft(){\n  var val = ['site_id','first_defined_by','date_defined'];\n  var num = getNumOfCorners();\n  var b = false;\n  val.forEach(function(element) {\n    if(!EXISTS(element) || VALUE(element)=='' || !VALUE(element)){\n      b = true;\n    }\n  });\n  if (!PROJECTNAME()) {\n    b = true;\n  }\n  if (num<3 || num>10){\n    b = true;\n  }\n  return b;\n}\n\n// Clean String Digit to a number after the dot\n// Remove 0 after on rigth\nfunction cleanDigit(val,num){\n  if (EXISTS(val)){\n    var tmp = FIXED(NUM(val),num, true);\n    var tmp2 = str2Num(tmp);\n    return tmp2;\n  }\n  return '';\n}\n\n// From String to number\nfunction str2Num(val){\n  if (ISNAN(val)){\n    var tmp = \"\"+val;\n    var nume = NUM(SUBSTITUTE(tmp,',','.'));\n    if (ISNUMBER(nume)){\n      return nume;\n    }\n    return val;\n  }\n  return val;\n}\n\n\n/*\n * REPEATABLE\n */\n\nfunction repeatableVariableInDict(repeatableVariable,dataname){\n  var t = {};\n  var i = 0;\n  var o = REPEATABLEVALUES(repeatableVariable,dataname);\n  o.forEach(function(element) {\n    if(!EXISTS(element) || element=='' || !element){\n      t[i]=\"\";\n    } else if(EXISTS(element.choice_values)){\n      t[i]=element.choice_values;\n    } else {\n      t[i]=element;\n    }\n    i+=1;\n  });\n  return t;\n}\n\nfunction getSizeOfDict(dict){\n  return LEN(Object.keys(dict));\n}\n\nfunction getNumOfSizeFor(repeatableVariable,dataname) {\n  if ($size_measurements != null){\n    return LEN(ARRAY(REPEATABLEVALUES(repeatableVariable,dataname)));\n  } else {\n    return 0;\n  }\n}\n\n// Search first in config then in current location\nfunction getLongitude(){\n  if (EXISTS(LONGITUDE())){\n    return cleanDigit(LONGITUDE(),7);\n  } else if (EXISTS(CONFIG().recordGeometry.coordinates[0])){\n    return cleanDigit(CONFIG().recordGeometry.coordinates[0],7);\n  }\n  return '';\n}\n\nfunction getLatitude(){\n  if (EXISTS(LATITUDE())){\n    return cleanDigit(LATITUDE(),7);\n  } else if (EXISTS(CONFIG().recordGeometry.coordinates[1])){\n    return cleanDigit(CONFIG().recordGeometry.coordinates[1],7);\n  }\n  return '';\n}\n\n\nfunction saveSitePosition(){\n  SETVALUE('site_latitude', getLatitude());\n  SETVALUE('site_longitude', getLongitude());\n}\n\n\nfunction saveCornersPosition(){\n  var n = getNumOfCorners();\n  if (n>0){\n    var cla = repeatableVariableInDict($corners, 'corner_latitude');\n    var clo = repeatableVariableInDict($corners, 'corner_longitude');\n    SETVALUE('corners_latitude',fromDictToString(cla));\n    SETVALUE('corners_longitude',fromDictToString(clo));\n  }\n}\n\nfunction fromDictToString(dict){\n  var n = getNumOfCorners();\n  var s = '';\n  for (var i = 0;i<n;i++){\n    if(!EXISTS(dict[i]) || dict[i]=='' || !dict[i]){\n      if (s!=\"\") s += \"<>\";\n    } else {\n      if (s!=\"\") s += \"<>\"+dict[i];\n      if (s==\"\") s += \"\"+dict[i];\n    }\n  }\n  return s;\n}\n\nfunction fromStringToDict(st){\n  var temp = st;\n  var dict = {};\n  var i    = 0;\n  while(CONTAINS(temp,'<>')){\n    var p = FIND(\"<>\", temp)-1;\n    var s  = \"\";\n    if (p>1) s  = LEFT(temp, p-1);\n    dict[\"\"+i]=s;\n    i+=1;\n    temp=RIGHT(temp, LEN(temp)-(p+2));\n    if (temp=='<>') temp = '';\n  }\n}\n\n\n\n\n\n\n/*****************************************************************\n                        FUNCTION CALL\n******************************************************************/\nfunction callback(event) {\n\n  /*****************************\n            LOAD RECORD\n  ******************************/\n  if (event.name === 'load-record') {\n    // Grab the project name\n    projectNameGV = PROJECTNAME();\n    if (isStandardUser()) {\n      SETSTATUSFILTER(['pending']);\n    }\n  }\n  \n  /*****************************\n            NEW RECORD\n  ******************************/\n  // Assign plant ID using timestamp with 8 characters\n  // Assign observed name as default user\n  if (event.name === 'new-record') {\n    var username = USERFULLNAME();\n    SETVALUE('first_defined_by', username);\n    loadDataQualityControl();\n  }\n\n  /*****************************\n            EDIT RECORD\n  ******************************/\n  if (event.name === 'edit-record') {\n    /*\n    - For field users, only show 'submitted' status when 'verified'\n      if the current role is one of the designated field user roles...\n    - make record and read-only if verified, submitted, approved or published\n    - lock status and project to all standard users when verified except person who verified\n    - lock status to all standard users when submitted\n    */\n    // viewConfig();\n    if (isReadOnly()){ // \n      // make read-only\n      readOnlyValues();\n      if (isStandardUser()){\n        // add the submitted status\n        SETSTATUSFILTER(['pending', 'verified', 'submitted', 'deleted']);\n        if (isRejected()){\n          SETSTATUSFILTER(['rejected', 'verified', 'submitted', 'deleted']);\n        }\n        // lock the record status\n        SETREADONLY('@status', true);\n        //... except for verified by the standard user who verified the record\n        if ((usernameGV == $verified_by) && (STATUS() == 'verified')) {\n          SETREADONLY('@status', false);\n        }\n      }\n    } else {\n      if (!isDraft() && isStandardUser()){\n        SETSTATUSFILTER(['pending', 'verified', 'deleted']);\n        if (isRejected()){\n          SETSTATUSFILTER(['rejected', 'verified', 'deleted']);\n        }\n      }\n      changeValues();\n      SETREADONLY('@status', false);\n    }\n  }\n\n  /*****************************\n            VALIDATE RECORD\n  ******************************/\n  if (event.name === 'validate-record') {\n    if (!PROJECTNAME()) {\n      INVALID('Select a project before saving.');\n    }\n    if (notSameCornersNumber() && isReadOnly() && STATUS()!='deleted'){\n      INVALID('You cannot change the number of corners under the current status.');\n    }\n    saveCornersPosition();\n  }\n\n  /*****************************\n            SAVE RECORD\n  ******************************/\n  if (event.name === 'save-record') {\n    if (isReadOnly()) {\n      SETPROJECT(projectNameGV);\n    }\n  }\n  \n  /*****************************\n            CHANGE STATUS\n  ******************************/\n  if (event.name === 'change-status') {\n    var today = new Date();\n    var status = STATUS();\n\n    if (status == 'pending'|| status == 'rejected') {\n      changeValues();\n    }\n\n    if (status == 'pending') {\n      if (isStandardUser()){\n        SETSTATUSFILTER(['pending']);\n      }\n    } else if (status == 'rejected') {\n      if (isStandardUser()){\n        SETSTATUSFILTER(['rejected']);\n      } else {\n        var numR = 1;\n        if (EXISTS($number_of_rejections)){\n          numR = $number_of_rejections+1;\n        }\n        SETVALUE('number_of_rejections',numR);\n        SETVALUE('rejected_by', usernameGV);\n        SETVALUE('date_rejected', today);\n      }\n    } else if (status == 'verified') {\n      readOnlyValues();\n      setNumOfCorners();\n      SETVALUE('verified_by', usernameGV);\n      SETVALUE('date_verified', today);\n      projectNameGV = PROJECTNAME();\n      ALERT('This will make the record read-only for all other standard users.');\n    } else if (status == 'deleted') {\n      readOnlyValues();\n      SETVALUE('deleted_by', usernameGV);\n      SETVALUE('date_deleted', today);\n      ALERT('This will make the record read-only for all other standard users. Deleted records can no longer be edited by standard users.');\n    } else if (status == 'submitted') {\n      SETVALUE('submitted_by', usernameGV);\n      SETVALUE('date_submitted', today);\n      ALERT('This will submit the record to the data manager for approval. Submitted records can no longer be edited by standard users.');\n    } else if (status == 'approved') {\n      SETVALUE('approved_by', usernameGV);\n      SETVALUE('date_approved', today);\n    } else if (status == 'published') {\n      SETVALUE('published_by', usernameGV);\n      SETVALUE('date_published', today);\n    }\n    loadDataQualityControl();\n  }\n\n  /*****************************\n            CHANGE PROJECT\n  ******************************/\n  // save user name and date for data control steps\n  if (event.name === 'change-project') {\n    if (projectNameGV != \"\" && isReadOnly()) {\n      ALERT('The project cannot be changed under the current status.');\n      SETPROJECT(projectNameGV);\n    }\n  }\n\n  /*****************************\n            CHANGE GEOMETRY\n  ******************************/\n  if (event.name === 'change-geometry') {\n    if (!EXISTS(event.field)) {\n      SETVALUE('site_latitude', getLatitude());\n      SETVALUE('site_longitude', getLongitude());\n    }\n    \n    // On REPEATABLE object\n    if (event.field === 'corners') {\n      SETVALUE('corner_latitude', getLatitude());\n      SETVALUE('corner_longitude', getLongitude());\n    }\n  }\n\n  /*****************************\n            CHANGE\n  ******************************/\n  if (event.name === 'change'){\n  }\n\n  /*****************************\n            CLICK\n  ******************************/\n  if (event.name === 'click'){\n  }\n\n  /*****************************\n            REPEATABLE\n  ******************************/\n  if (event.name === 'load-repeatable'){\n    if (event.field === 'corners') {\n      if (isReadOnly()) {\n        setConfig4LocationDraft(false);\n      }\n    }\n  }\n\n  if (event.name === 'new-repeatable'){\n    // Assign a default incremental value\n    if (event.field === 'corners') {\n      var serial = REPEATABLENUMBER();\n      SETVALUE('corner_number', serial);\n    }\n  }\n  \n  if (event.name === 'validate-repeatable'){\n    if (event.field === 'corners') {\n      if (isReadOnly()) {\n        INVALID('You cannot add a corner under the current status.');\n      }\n    }\n  }\n}\n\n/********** FUNCTIONS **********/\nON('load-record', callback);\nON('new-record', callback);\nON('edit-record', callback);\nON('validate-record', callback);\nON('save-record', callback);\nON('change-status', callback);\nON('change-project', callback);\nON('change-geometry', callback);\nON('change-geometry', 'corners', callback);\nON('load-repeatable', 'corners', callback);\nON('new-repeatable', 'corners', callback);\nON('validate-repeatable', 'corners', callback);\nON('save-repeatable', 'corners', callback);\n",
  "status_field": {
    "choices": [
      {
        "color": "#FF8819",
        "label": "Pending Verification",
        "value": "pending"
      },
      {
        "color": "#CB0D0C",
        "label": "Rejected",
        "value": "rejected"
      },
      {
        "color": "#1891C9",
        "label": "Verified",
        "value": "verified"
      },
      {
        "color": "#87D30F",
        "label": "Submitted",
        "value": "submitted"
      },
      {
        "color": "#2D5D00",
        "label": "Approved",
        "value": "approved"
      },
      {
        "color": "#2D5D00",
        "label": "Published",
        "value": "published"
      },
      {
        "color": "#242424",
        "label": "Deleted",
        "value": "deleted"
      }
    ],
    "data_name": "record_status",
    "default_previous_value": false,
    "default_value": "pending",
    "description": "Status of record. Record first requires verification. Once verified, it can be submitted for approval; this locks the record for standard users. If approved, the record eventually gets published. If rejected, it goes back to standard users for further verification.",
    "disabled": false,
    "enabled": true,
    "hidden": false,
    "key": "@status",
    "label": "Record Status",
    "read_only": false,
    "required": false,
    "type": "StatusField"
  },
  "title_field_keys": [
    "33f0"
  ],
  "updated_at": "2018-08-21T19:54:25Z",
  "version": 263
}
